function [Y,Xf,Af] = myNeuralNetworkFunction2(X,~,~)
%MYNEURALNETWORKFUNCTION2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 30-Apr-2018 08:38:20.
% 
% [Y] = myNeuralNetworkFunction2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 26xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-0.472549019381404;-0.472549019381404;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.480392156168818;-0.476470587775111;-0.468627449125052;-0.472549019381404;-0.468627449125052;-0.464705880731344;-0.464705880731344;-0.468627449125052;-0.472549019381404;-0.468627449125052;-0.472549019381404;-0.472549019381404;-0.472549019381404;-0.472549019381404;-0.472549019381404;-0.468627449125052];
  x1_step1_gain = [2.05645161338203;2.05645161338203;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04000000144392;2.04819277204959;2.06477733189016;2.05645161338203;2.06477733189016;2.07317073519216;2.07317073519216;2.06477733189016;2.05645161338203;2.06477733189016;2.05645161338203;2.05645161338203;2.05645161338203;2.05645161338203;2.05645161338203;2.06477733189016];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-23.316218904542584;-5.87920263911231;-0.24140657200667512;0.75808739585934215;-1.1906055406538665];
  IW1_1 = [-9.1193724602828343 -0.5245450204370834 -0.74130402843134813 0.41806061301931025 -0.24193967356659465 0.89901877279932385 0.16154546940103282 0.57114997547263069 -0.14607398741401539 -11.476677533172891 6.3218949103946498 3.7771482196894959 4.0989215960705145 2.8876638719009007 -4.7810772221576672 -2.5419083521917787 -0.1682399672637265 -2.7032136859665394 -1.1993544027108005 -1.3781615787404446 -2.3027902489661241 -2.8092003575655649 -0.85300309474500879 -2.339382538489617 -0.69565253675830974 -1.2616785839451563;0.2135382966671435 7.8174738272058066 7.1887418755889074 -0.00016250037259207703 -9.9229197103975153 -10.998486908469564 0.93829597000313136 9.6264923047483393 1.8549230939895198 -5.238992912475541 17.716733484192403 4.406436377677438 14.65265585768104 0.11558413030956706 -5.6326773183752206 -1.7551517818877238 -0.11592740542164655 -1.1274584927480371 -0.072635585728048888 0.38393417027175619 -0.40656993609753483 -0.36507781245968635 0.42984950633164853 0.2824325355426307 0.68906186001459047 1.4722553686362791;0.26175363910101773 0.080050455843103552 0.2541309934955322 0.097477302079997385 0.22239759265018991 0.093398051802735207 0.18974917231522845 0.046688700247401821 -0.11562788177993713 -0.017906645656810469 -0.034855477483822846 -0.0039987081038779029 -0.013549177254588865 -0.32051817214158551 -0.027814354178041369 -0.37570367265995291 -0.13519948251670322 -0.24281500106844278 -0.089441128979141374 -0.08168336017937404 0.020244558874770946 -0.03566001824182552 0.02579676252503306 -0.028431450881739127 0.017010476978154856 -0.031396406827644302;0.20122272514920125 0.072300230701235202 0.23278621009416214 0.091986119919920326 0.20953027541231514 0.087905928630522503 0.19605133792405069 0.034151510923515142 -0.11862742965245746 -0.05664030045531953 -0.071708347952881987 -0.056596548748203808 -0.14437666253088477 -0.1988505166780522 0.06062873710640794 -0.099074083259425669 -0.049103095044921136 -0.0045909908612183255 0.08246470071959025 0.11477732092167493 0.19186076492579401 0.14752455107464924 0.20037688535406908 0.14523943075766085 0.1810644545718271 0.14808386467931547;0.31835872266840931 0.092387902695841448 0.26613013413439868 0.10165160042547712 0.22204781388498682 0.091840661476882635 0.16667736905335057 0.049228498332579591 -0.11016770769881359 0.0089945500126214165 -0.0096320745095553589 0.032007382786204609 0.092323507026225229 -0.43003118852548206 -0.12280887139833815 -0.62596294968739741 -0.21317169101926306 -0.45998579781462751 -0.24982787574428431 -0.26448338338315291 -0.14222277378855658 -0.2033306780830752 -0.1339063228889591 -0.18148502336224628 -0.12707749923258177 -0.18356447355288719];
  
  % Layer 2
  b2 = 0.062295221628983953;
  LW2_1 = [-0.78876800677111425 0.81345827148175276 19.928247517321363 -10.360274459048403 -10.432535861984311];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 1.02313891987647;
  y1_step1_xoffset = -0.977384381116825;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
